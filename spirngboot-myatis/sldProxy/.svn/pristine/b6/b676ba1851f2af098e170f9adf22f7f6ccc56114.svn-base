package com.ule.uhj.sldProxy.sldBiz;

import java.util.List;

import com.ule.uhj.sldProxy.dao.InterfaceAccessInfoMapper;
import com.ule.uhj.sldProxy.model.InterfaceAccessInfo;
import com.ule.uhj.sldProxy.model.InterfaceAccessInfoExample;
import com.ule.uhj.sldProxy.model.InterfaceAccessInfoWithBLOBs;
import org.apache.commons.logging.Log;
import org.apache.commons.logging.LogFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Component;

import com.ule.oracle.dao.ConstantMapper;
import com.ule.oracle.model.Constant;
import com.ule.oracle.model.ConstantExample;
import com.ule.uhj.sldProxy.util.PropertiesHelper;

@Component("BetaInterHelperService")
public class BetaInterHelperService {
	private static Log log = LogFactory.getLog(BetaInterHelperService.class);
	
	@Autowired
    ConstantMapper constantMapper;
	@Autowired
	InterfaceAccessInfoMapper interfaceAccessInfoMapper;
	
	public String getBetaInterfaceResponse(String transCode){
		log.info("interface block check...");
		if("beta".equals(PropertiesHelper.getDfs("env"))){
			log.info("interface block env is beta...");
			ConstantExample constantExample = new ConstantExample();
			constantExample.createCriteria().andElementKeyEqualTo("block_"+transCode);
			List<Constant> list = constantMapper.selectByExample(constantExample);
			if(list!=null&&list.size()>0){
				return list.get(0).getElementValue();
			}
		}
		return null;
	}

	public String getBetaInterfaceResponseByInterfaceInfo(String transCode){
		log.info("interface block check...");
		if("beta".equals(PropertiesHelper.getDfs("env"))){
			log.info("interface block env is beta...");
			InterfaceAccessInfoExample constantExample = new InterfaceAccessInfoExample();
			constantExample.createCriteria().andInterfaceTypeEqualTo("block_"+transCode);
			List<InterfaceAccessInfoWithBLOBs> list = interfaceAccessInfoMapper.selectByExampleWithBLOBs(constantExample);
			if(list!=null&&list.size()>0){
				String response_str = new String(list.get(0).getResponseInfo());
				log.info("response_str = "+response_str);
				return response_str;
			}
		}
		return null;
	}
	
}
